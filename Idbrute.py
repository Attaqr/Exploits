import subprocess

token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2OTE5NjUyNjF9.pTBecZEs6RmUyRUELE3v-UxTYsFZu6olmuiEhBUWXBc'

def cmdcall():
    for x in range(2000):
        data = '{{"id": "{}"}}'.format(x)
        cmd = ['grpcurl', '-plaintext', '-d', data, '-H', f"token: {token}", '10.10.11.214:50051', 'SimpleApp.getInfo']

        result = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        output = result.stdout.decode('utf-8')
        error = result.stderr.decode('utf-8')
        counter = 0

        print(f"Executing for ID={x}")
        print(f"Output: {output}")
        if error:
            print(f"Error: {error}")
        elif "unexpected" not in output:
            counter += 1
        elif counter == 2:
            print('Found correct ID:', (x))
            break

cmdcall()
